---
title: "2008 financial crisis in US and its impact on median income and housing prices."
author: "Studentnames and studentnumbers here Marine Latour, Bryan Berlijn, Toine van Bakel, Tyfarah Wedervoort, Shruti Ramasamy, Naomi van Leuvensteijn, Rocco vitale
"
date: "`r Sys.Date()`"
output: pdf_document
---

# Set-up your environment

```{r package_install, include=FALSE}
install.packages(c("ggplot2","tidyverse", "dplyr", "sf", "tigris", "viridis"))
```

```{r packages}
library(tidyverse)
library(readr)
library(dplyr)
library(ggplot2)
library(viridis)
library(tigris)
library(sf)
```

# Title Page

Include your names = "Marine Latour, Bryan Berlijn, Toine van Bakel, Tyfarah Wedervoort, Shruti Ramasamy, Naomi van Leuvensteijn, Rocco vitale"

Include the tutorial group number

Include your tutorial lecturer's name

# Part 1: Problem Motivation & Literature

## 1.1: Why was the 2008 Financial Crisis in the US a Social Problem?

The 2008 Financial Crisis, commonly referred to as the Great Recession, originated in the U.S.  and lasted from late 2007 to mid-2009. It was a major social problem due to its severe effects on median household income and housing prices, which significantly undermined economic security for millions of Americans. The crisis was mainly caused by excessive household leverage, particularly within the subprime mortgage sector, which triggered a steep decline in housing prices and a wave of mortgage defaults (Mian & Sufi, 2010a). The housing market collapse diminished household wealth and reduced consumer spending, intensifying the recession’s severity and duration. 

Mian and Sufi (2010a) demonstrate that households with higher leverage before the crisis faced substantially greater financial distress, leading to sharp reductions in durable consumption and higher unemployment rates at the county level. Furthermore, Morrissey et al. (2020) show that during the Great Recession, households with lower education levels, children, or without homeownership experienced significantly higher income and employment instability, an effect closely linked to increased financial hardship (pp. 3–4). Together, these economic and social disruptions illustrate why the Great Recession was not only a financial crisis but also a profound social crisis, affecting housing security, income stability, and overall well-being. 

## 1.2: What sources have identified this topic as a social problem?

Several peer-reviewed studies have recognized the 2008 Financial Crisis as a critical social problem. Mian and Sufi’s research (2010a, 2010b) emphasizes the role of household leverage and its consequences on the broader economy and local communities, highlighting the direct connection between financial market failures and deteriorating social conditions such as unemployment and poverty. Morrissey et al. (2020) extend this understanding by detailing how economic instability disproportionately affected vulnerable groups, including less-educated households and renters, thereby exacerbating social inequality during the recession. 

## 1.3: Has a part of this topic not been researched yet?

While extensive research has analyzed household leverage, foreclosures, unemployment, and macroeconomic impacts of the 2008 financial crisis such as by Mian & Sufi, 2010a, 2010b, Morrissey et al., 2020), less academic focus has been placed on the geographic variation in how the relationship between housing price shifts and median income evolved across states during the crisis. What remained unexplored is quantitatively assessing how differently these two indicators interacted on a state-by-state basis, thus creating regional disparities. 

## 1.4: How does the report bring new perspective on the topic?

This report creates a merged, state-level dataset to analyze income and housing prices together. Also, the following analysis will highlight where there was a misalignment between housing prices and income levels. Moreover, this report will visualize the regional variation among states in housing and income trends using plots and correlations. Furthermore, this report examines these patterns through the wealth effect. The wealth effect demonstrates how changes in prices of assets, especially property values, influences consumer spending. During the 2008 crisis, as house prices were declining, the confidence of consumers in the value of their property also fell. Thus, they perceived a reduction in household wealth. This negative wealth effect, in turn, reduced consumer spending, which consequently contributed to higher unemployment at the country level.  

# Part 2 - Data Sourcing

## 2.1 Load in the data

Preferably from a URL, but if not, make sure to download the data and store it in a shared location that you can load the data in from. Do not store the data in a folder you include in the Github repository!

```{r loading_data}
hpi_data_set = https://www.fhfa.gov/hpi/download/annual/hpi_at_state.xlsx
income_per_state = https://nces.ed.gov/programs/digest/d11/tables/xls/tabn025.xls
```

## 2.2 Provide a short summary of the dataset(s)

```{r}
head(hpi_at_state)
head(tabn025)
```

This first dataset, published by the **Federal Housing Finance Agency (FHFA)**, provides yearly data on house price trends across all American States using the House Price Index (HPI). The HPI measures changes in single-family home prices over time, constructed using repeat-sales data and financed through mortgages backed by Fannie Mae and Freddie Mac. The repeat-sales methodology enhances accuracy by tracking price changes for the same properties over time.

The second dataset, published by the **National Center for Education Statistics** (NCES), provides annual median household income data for the United States and the individual states. It offers insights into the economic conditions of each state over a specific period.

## 2.3 Describe the type of variables included

### Housing Price Index Dataset

**Credibility:** FHFA is a U.S. federal agency responsible for regulating the housing finance system. Its data is trusted by researchers, policymakers, and financial institutions due to its transparency, government oversight, and long historical coverage. 

**Metadata Overview** 

-   **Frequency:** Annually 

-   **Time Range:** This covers from 1975 to 2024, but our focus point is 2008  

-   **Geographic Scope:** States 

-   **Key Variables:** 

\- **Purchase-Only Index** (focuses on purchase transactions only) 

\-**All-Transactions Index** (includes both purchases and refinances mortgages) 

\-**Percent Changes** (year-over-year growth) 

\-**Seasonally Adjusted & Not Seasonally Adjusted values** 

-   **Format:** Excel report (XLSX) 

**Why This Data is Suitable for the Topic** 

These specific FHFA reports show the progression of U.S. housing conditions during and before the period of financial crisis. They offer reliable, government-backed data with consistent methodology dating back to 1975. The breakdown by state level allows for a better understanding of how different regions were impacted by the price change. Its focus on repeat-sales ensures accurate tracking of real home price changes over time, making it well-suited for studying the dynamics of the housing market crisis. 

**Data Limitations** 

1.  **Market Coverage Gaps:** Excludes cash sales and jumbo loans, potentially underrepresenting luxury and investor markets, as well as homes not financed through Fannie Mae or Freddie Mac. 

<!-- -->

2.  **Limited detail within reports:** While the reports provide detailed price index, they do not contain demographic, income, or specific housing type data, limiting deeper analysis. 

### Income Dataset

**Credibility:** The NCES is the primary federal unit responsible for collecting and analysing data related to U.S. Department of Education, which makes this data highly reliable, objective, and a source of authority for economic statistics. 

**Metadata Overview** 

-   **Frequency:** Annually  

<!-- -->

-   **Time range:** Covers 1990, 2005-2010, but our focus point is 2008 

<!-- -->

-   **Geographic scope:** National (United States) and all U.S. States 

<!-- -->

-   **Key Variables:** 

-Median household income 

-Margin of error for estimates 

<!-- -->

-   **Format:** Excel (XLSX) 

<!-- -->

-   **Income adjustment:** All income values are expressed in 2010 dollars 

 

**Why This Data is Suitable for the Topic?** \
This dataset provides a clear and direct view of the median household income trends at state level in America over time, including periods of economic change. It can be used to observe income differences between states and the economic well-being of households. The breakdown by state level allows for a better understanding of how different regions were impacted by the economic crisis. 

**Discuss data limitations** 

1\. **Limited income detail:** The table provides median household income, but does not break it down by demographic characteristics, for example, race, age or educational attainment. 

2\. **Limited methodology used**: The data provided lacks indication about the survey methods used and inflation adjustments. For instance, it might be possible that certain states used different survey methods than others, making it difficult to accurately portray differences in cost of living among them. 

**Explain how these 2 datasets are different or complementary** 

The datasets are complementary as they both revolve around an important asset, namely housing, while offering state-level data across multiple years. The FHFA dataset provides insight into housing prices, reflecting the market value of a household’s asset, while the NCES dataset provides information on median income which is a critical factor which influences a household’s ability to afford housing, whether through mortgage payments, rent, or homeownership costs. The connection between the two datasets lies in the fact that income determines a household’s ability to purchase or maintain housing. Conversely, fluctuations in housing prices can influence median income level through the wealth effect.  

# Part 3 - Quantifying

## 3.1 Data cleaning

```{r}
#Changing both data sets to data frame 
tabn025 = as.data.frame(tabn025)
hpi_at_state = as.data.frame(hpi_at_state)
```

```{r}
#Filtering the HPI dataset for 20006-2010 
hpi_filtered = hpi_at_state %>%
  filter(Year %in% c(2006,2007,2008,2009,2010)) %>%
  select(State, Year, HPI)

```

```{r}
#Filtering the Income data set for 2006-2010
income_to_use = select(tabn025,State,"2006","2007","2008","2009","2010")
```

```{r}
#Formatting the income data set into a long format
income_long = income_to_use %>%
  pivot_longer(
    cols = -State,
    names_to = "Year",
    values_to = "Income"
  ) 
```

```{r}
#Omitting the NA rows since we dont need 
income_long_no_NA = na.omit(income_long)
```

```{r}
#Making the State titles the same 
income_long_no_NA$State = income_long_no_NA$State %>%
  str_replace_all("[.]", "") %>%
  str_squish() %>%
  str_trim()
```

```{r}
#Making the Year the same numeric class 
hpi_filtered$Year = as.numeric(hpi_filtered$Year)
income_long_no_NA$Year = as.numeric(income_long_no_NA$Year)
```

```{r}
#merging the 2 data sets
merge_2 = inner_join(hpi_filtered , income_long_no_NA, by = c("State","Year"))
```

## 3.2 Generate necessary variables

#### New variable 1: Housing price to income ratio. 

Changes in this ratio over time would indicate whether housing prices are rising faster or slower than income. 

**Housing Price to Income Ratio**= House Price Index Value / Median Household Income Value 

**Why the creation of this variable is informative and useful for your analyses?**

We used this ratio to measure the affordability of housing in each state by comparing housing prices to household income. A rising ratio means less affordable housing, while a lower ratio suggests more affordability. We observed that before the 2008 financial crisis, the price_to_income_ratio behaved differently for each state.  \
The creation of this variable combines the HPI, the income into one indicator as well as data on individual states. Therefore, the variable assesses a household’s financial situation, differences in economic and social conditions across different geographic areas or regions, and the recovery post-crisis.  

 \
**What you intend to analyse/visualize using this variable?** 

With our new variable, we can visualize a Price- Income divergence. This enables us to look at whether house prices increase faster than the median household incomes. In an economy functioning normally, house prices and income are steadily increasing together. Thus, the ratio will be lower in a normal economy. However, house prices can increase faster than incomes which was common in many states before the crisis of 2008. This was because of expectations about future prices for houses. Moreover, the new variable helps to evaluate which states were better off and which ones were worse off in terms of housing affordability in the midst of the crisis. 

```{r gen_var1}
#create variable 1: house prices to income ratio
merge_2 <- merge_2 %>%
  mutate(price_to_income_ratio = (HPI / Income)*1000)
```

#### New variable 2: Link between the housing prices and income value. 

This link explains the wealth effect and how falling property value led to lower spending and thus lower incomes. 

**Link between income value and house price:** link between housing price change (HPIt-HPIt-1 ) and income value change (Incomet-Incomet-1 ) , where t= year. 

**Why the creation of this variable is informative and useful for your analyses?** 

As explained earlier, our report evaluates whether the wealth effect had an impact in the 2008 U.S. financial crisis. This direct relationship between the income value change and the housing prices change helps to analyse whether a drop in housing prices led to a fall in the income value. 

**What you intend to analyse/visualize using this variable?** 

We created a new column called link_price_to_income, which labels the relationship between changes in income and housing prices using characters such as “Both Fell”, “Income fell, HPI increased”, “Income stable, HPI fell”, “Income stable, HPI increased”, “Income increased, HPI fell”, “Income increased, HPI increased”. This allows us to directly visualize the link between two variables more easily, for example, we can identify which states experienced “Both fell” during the financial crisis, this helps to establish a direct correlation between the two variables, indicating that the wealth effect worsened the crisis. In this context, the new variable shows how the connection between the two directly contributed to economic and social hardships. 

```{r gen_var2}
# create new variable of income_change and HPI_change

merge_2 <- merge_2 %>%
  arrange(State, Year) %>%  # ensure data is ordered
  group_by(State) %>%      # compute changes within each state
  mutate(
    income_change = Income - lag(Income),
    HPI_change = HPI - lag(HPI)
  ) %>%
  ungroup()

```

```{r gen_var2}
#create variable 2: link between income loss & housing price drop 

merge_2 <- merge_2 %>%
  mutate(
    link_price_to_income = case_when(
      income_change < 0 & `HPI_change` < 0  ~ "Both fell",
      income_change < 0 & `HPI_change` > 0 ~ "Income fell, HPI increased",
      income_change == 0 & `HPI_change` < 0 ~ "Income stable, HPI fell",
      income_change == 0 & `HPI_change` > 0 ~ "Income stable, HPI increased",
      income_change > 0 & `HPI_change` < 0 ~ "Income increased, HPI fell",
      income_change > 0 & `HPI_change` > 0 ~ "Income increased, HPI increased",
      TRUE ~ "Other"
    )
  )
```

```{r gen_var2}
#describing missing data for 2006 as NAs 
merge_2$link_price_to_income[merge_2$Year=="2006"] = "NA"

merge_2$link_price_to_income[merge_2$Year=="2006"] = "NA"
```

## 3.3 Visualize temporal variation

```{r}

```

## 3.4 Visualize spatial variation

```{r visualise_map}

```

Here you provide a description of why the plot above is relevant to your specific social problem.

## 3.5 Visualize sub-population variation

What is the poverty rate by state?

```{r visualise_subpopulations}
dataset$inmetro <- dataset$inmetro %>% as.factor()
# Boxplot of poverty rate by state using the 'midwest' dataset
ggplot(dataset, aes(x = inmetro, y = percadultpoverty)) +
  geom_boxplot() +
  labs(
    title = "Distribution of Poverty Rates by Metropolitan status (Midwest counties)",
    x = "Metropolitan Area",
    y = "Poverty Rate of Adults (%)"
  ) +
  theme_minimal() +
  theme(
    legend.position = "right"
  )
```

Here you provide a description of why the plot above is relevant to your specific social problem.

## 3.6 Event analysis

Analyze the relationship between two variables.

```{r analysis}

```

Here you provide a description of why the plot above is relevant to your specific social problem.

# Part 4 - Discussion

## 4.1 Discuss your findings

# Part 5 - Reproducibility

## 5.1 Github repository link

Provide the link to your PUBLIC repository here: ...

## 5.2 Reference list

Use APA referencing throughout your document.
